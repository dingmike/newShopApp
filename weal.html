<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit">
		<meta content="yes" name="apple-mobile-web-app-capable"/>
		<meta content="black" name="apple-mobile-web-app-status-bar-style" />
		<meta content="telephone=no" name="format-detection"/>
		<meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE,Chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
		<link rel="stylesheet" type="text/css" href="css/index.css"/>
		<link rel="stylesheet" type="text/css" href="css/hp.css"/>
		<link rel="stylesheet" href="lib/layer/2.4/skin/layer.css"/>
		<script src="js/flexible.js" type="text/javascript"></script>
		<script src="js/jquery-1.11.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
		<script type="text/javascript" src="js/jquery.downCount.js"></script>
		<!--flex 布局-->
		<script src="js/flexible.js" type="text/javascript"></script>
		<script src="js/default.js"></script>
		<script src="js/template.js"></script>
		<script src="js/template-helper.js"></script>
		
		<title>专区</title>
		<style type="text/css">
			.buy-load{height: 60px;}.rec-bro{padding-bottom: 0;}
			.rec-bro a{}
			.bro-sto-nam {
				display: block;
				font-size: 12px;
				width: 100%;
				height: 0.5866667rem;
				line-height: 0.58666667rem;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				/*padding-left: 0.26667rem;*/
				/* display: -webkit-box; */
				line-clamp: 2;
				-webkit-line-clamp: 2;
				-webkit-box-orient: vertical;
			}

			.pt-bottom-box{
				/*display: flex;*/
				/*display: -webkit-flex; !* Safari *!*/
				/*flex-direction: row;*/
				/*justify-content: center;*/
				background: orangered;
				color: #fff;
				height: 1.4rem;
			}
			.price-bottom-m{
				display: flex;
				display: -webkit-flex; /* Safari */
				flex-direction: row;
				justify-content: center;
			}

			.price-bottom-l {
				/*padding: 0.05333rem;*/
				height: 0.8rem;
				display: flex;
				display: -webkit-flex; /* Safari */
				flex-direction: row;
				justify-content: center;
			}

			.price-b-l-first {
				font-size: 0.45rem;
				height: 0.8rem;
				line-height: 0.8rem;
				margin-left: 0.266667rem;
			}

			.price-b-l-sencond {
				float: left;
				font-size: 0.266667rem;
			}


			.price-bottom-m {
				/*font-size: 0.26667rem;*/
			}

			.price-b-l-sencond .price-logo {
				background-color: #ffccc6;
				color: #ff5a3a;
				width: 0.8rem;
				height: 0.29333rem;
				border-radius: 0.10666rem;
				padding: 0.0266666rem 0.053333rem;
			}

			ul.countdown {
				list-style: none;
				width: 3.5rem!important;
				transform: scale(0.8)!important;
			}
			.price-time {
				font-size: 0.32rem;
				/* transform: scale(0.9); */
				height: 0.93rem;
				line-height: 0.93rem;
				margin-left: 0.2rem;
			}
			.price-time-loading{
				margin-top: 0.06rem;
			}
			/*loading--start--*/
			.status-bar[data-v-5d44c782] {
				position: relative;
				box-sizing: border-box;
				width: 2.4rem;
				height: 0.36rem;
				/* transform: scale(0.75); */
				line-height: 0.3733333rem;
				border-radius: 0.186666667rem;
				color: #fff;
				background: url('./img/ad_imgs/beijing.png') repeat-x;
				background-size: contain;
				text-align: center;
				overflow: hidden;
			}
			.status-progress[data-v-5d44c782] {
				border-radius: 0.186666667rem;
				position: absolute;
				top: 0;
				left: 0;
				height: 100%;
				min-width: .13rem;
				/* background: url(/img/ad_imgs/jindu.png) repeat-x; */
				background-size: contain;
			}
			.status-num[data-v-5d44c782] {
				font-size: 0.32rem;
				position: absolute;
				left: 0.8rem;
			}
			.status-soldrate[data-v-5d44c782] {
				font-size: 0.34rem;
				position: absolute;
				left: 1.3333rem;
			}
			.status-msg-h{
				position: relative;
				text-indent: 1.10rem;
				/*width: 2.32rem;*/
			}
			.status-msg-h:before{
				content: attr(text);
				line-height: 0.3733333rem;
				height: 0.333333rem;
				position: absolute;
				left: 0;
				font-size: 0.3rem;
			}
			.status-msg-h:after{
				content: attr(text);
				position: absolute;
				left: 0;
				/* width: 100%; */
				/* height: 38px; */
				height: 0.3733333rem;
				line-height: 0.3733333rem;
				white-space: nowrap;
				overflow: hidden;
				transition: width 1s ease;
				width: 57%;
				color: red;
				font-size: 0.3rem;
				/* transform: scale(0.75); */
				/* background: #0BF; */
				background: url('./img/ad_imgs/jindu.png') repeat-x;
			}

			.pin-tuan-h{
				background-color: #ffffff;
				width: 1.6rem;
				height: 0.52rem;
				line-height: 0.52rem;
				/* margin-top: 0.37333rem; */
				border-radius: 4px;
				margin-left: 0.2666rem;
				font-size: 0.3733333rem;
				color: orangered;
				font-weight: 600;
			}

			.bro-zy-num-h {
				display: block;
				float: left;
				color: #a8a8a8;
				font-size: 0.2433rem;
				/* border: 1px solid #ff2a00; */
				/* padding: 0 5px; */
				/* border-radius: 4px; */
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				width: 2.72rem;
				text-align: left;
			}
			.bro-sto-e-h {
				display: block;
				float: right;
				color: #9c9797;
				font-size: 0.32rem;
				transform: scale(0.8);
				/* background-color: #f1f1f1; */
				border-radius: 2px;
				text-align: center;
				/* padding: 1px 4px 1px 4px; */
				/* width: 61px; */

			}
			.loading-now{
				height: 40px;
				line-height: 20px;
				padding-bottom: 40px;
				font-size: 14px;
				color: #474747;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<header>
				<div class="sto-nav-left">
					<img src="img/fanhui.png" alt="" onclick="javascript:history.back(-1);"/>
				</div>
				<div class="sto-nav-sear">
					专区
				</div>
				<div class="sto-nav-right">
						<img src="img/gouwuche.png"/>
					<div class="nav-car-num"></div>
				</div>
			</header>
			<div class="content">
				<div class="sort-box bod-show"></div>
				<script type="text/template" id="sort-box">
					<ul>
						<li class="on">全部商品</li>
						{{each data as k i}}
							{{if k.catParent==0}}
								<li data-id="{{k.catId}}">{{k.catName}}</li>
							{{/if}}
						{{/each}}
					</ul>
				</script>
				
				
				<div class="sort-list">
					<div class="sort-st">综合排序</div>
					<div class="sort-cor" data-sort='1'>
						销量优先
					</div>
					<div class="sort-cor" data-sort='5'>
						拼单优先
					</div>
					<div class="sort-cor" data-sort='2'>
						广告金优先
					</div>
					<div class="sort-cor xdui" data-sort=''>
						价格
						<div class="sanjiao-box">
							<span class="sanjiao-down"></span>
   	 						<span class="sanjiao-up"></span>
						</div>
					</div>
				</div>
				
				<div class="rec-bro top10" style="font-size: 0.32rem;text-align: center;">

				</div>
				<script type="text/template" id="rec-bro">
					{{each data as k i}}
							
								<div class="bro-sto-left">
									<a href="{{k.fightAloneTime !==null?'sto-detail-pd.html':'sto-detail.html'}}?id={{k.productId}}">
										<div class="bro-img">
											<img src={{k.productImg}}>
										</div>
										<span class="bro-sto-nam">{{k.productName}}</span>
										<div class="bro-num-box">
											<span class="bro-sto-num">￥{{k.sellPrice}}</span>
											<span class="bro-sto-yj"><s>￥{{k.marketPrice}}</s></span>
											{{if k.productEdian!=0}}
											<span class="bro-sto-e">广告金:<span class="e-st">{{k.productEdian*k.fxparam}}</span></span>
											{{/if}}
										</div>

										{{if k.fightAloneTime !==null}}
										<div class="pt-bottom-box">
											<div class="price-bottom-l">
												<div class="price-b-l-first">￥<span>{{k.collagePrice}}</span></div>
												<div class="price-time"><span style="float: left;">距结束：</span>
													{{if k.fightAloneTime!==null}}
													<ul class="countdown countdown{{k.productId}}"  data-clock="{{k.fightAloneTime}}">
														<li style="display: none;">
															<span class="days">00</span>
														</li>
														<li class="seperator" style="display: none;">.</li>
														<li><span class="hours">00</span>
														</li>
														<li class="seperator">:</li>
														<li><span class="minutes">00</span>
														</li>
														<li class="seperator">:</li>
														<li><span class="seconds">00</span>
														</li>
													</ul>
													{{/if}}
												</div>
											</div>
											<div class="price-bottom-m">
												<div class="price-time-loading">
													<div data-v-5d44c782="" class="status-bar">
														<div data-v-5d44c782="" class="status-progress"></div>
														<div data-v-5d44c782="" class="status-msg-h"  data-total="{{k.fightAloneNumber}}" data-last="{{k.areadFightAlone}}" id="myStatusLoading{{k.productId}}" text="{{k.areadFightAlone}}/{{k.fightAloneNumber}}">
															<!-- <div data-v-5d44c782="" class="status-num">10</div>
                                                             <span data-v-5d44c782="" class="status-soldrate">200</span>-->
														</div>
													</div>
												</div>
												<button class="pin-tuan-h" data-productId="{{k.productId}}">马上拼</button>
											</div>
										</div>
										{{else}}
										<div class="bro-zy-box">
											{{if k.shopName}}
											<span class="bro-zy-num-h">{{k.shopName}}</span>
											{{/if}}
											<span class="bro-sto-e-h"><span>{{k.productSales}}人付款</span></span>
										</div>
										{{/if}}
									</a>
								</div>
					{{/each}}
				</script>
			</div>

		</div>
		<script type="text/javascript">
			$(function(){

                // 获取分销ID和值
                var fxIdData;
                getFxId(function(res){
                    fxIdData = res;
                });

				var catId='',sort='',time=0; //点击次数;
				//分页  初始化
 				var listparamUL={
					cat_id:catId,
					sort:sort,
					productType: 1,//1 代表福利专区  2代表限时抢购 3代表
					pageNo:currentpage,
					pageSize: 8
				};
				
				
				
				//判断用户登录过没有
				if(!token){
					$('.nav-car-num').css('display','none');
				}else{
						//个人的购物数量
						getInfo('post',ajaxUrl+'/productsInfo/cartCount?token='+token,{},setcartCountHtml);
						function setcartCountHtml(r){
							$('.nav-car-num').text(r.count);
						}
					
				}
				
				//  没有登录请求登录去
				$('.sto-nav-right img').click(function(){
					if(!token){
						location.href='login.html';
					}else{
						location.href='store.html';
					}
				});
				
				
				//页面进来的时候初始化数据
				getList('.rec-bro','post',ajaxUrl+'/productsInfo/boon/productlist',listparamUL,getListdata);
				$('.content').scroll(function () {
			        totleHeight = parseFloat($('.content').height()) + parseFloat($('.content').scrollTop());
			        if (($(".content")[0].scrollHeight == totleHeight) && !listLoading) {
			            ++currentpage;
			            listparamUL.pageNo=currentpage;
			            setclcik();
			            $('.sort-list div').click(function(){
							$(this).css('color','#ff5a3a').siblings().css('color','#9b9b9b');
						});
			            $('.rec-bro').append('<div class="loading-now">正在加载中...</div>');
			            getList('.rec-bro','post',ajaxUrl+'/productsInfo/boon/productlist',listparamUL,getListdata);

			        }
			   });
			    //页面渲染    
			    function getListdata(obj, r){
			    	if (r.data.length === 0 && currentpage === 1) {
                        $(obj).html('<div class="_nodata">暂无数据</div>');
                    } else if (r.data.length !== 0) {

                        // 显示广告金
                        for(var i=0; i<r.data.length; i++){
                            for(var j = 0; j< fxIdData.length; j++){
                                if(r.data[i].fxparam == fxIdData[j].id){
                                    r.data[i].fxparam =fxIdData[j].mine;
                                }
                            }

                        }

                        var html= template('rec-bro', r);
						var countDownArr=[];
						$.each(r.data, function (key, val) {

							countDownArr.push('countdown' + val.productId);
                        });

                        if (currentpage === 1) {
                            $(obj).html(html);
                            //倒计时
                            countDownEvent(countDownArr);


                        } else {
                            $(obj).append(html);
                            //倒计时
                            countDownEvent(countDownArr);
                        }
                        $('.loading-now').remove();
                    } else {
                        listLoadingLock = true;
                        if( $('.loading-now')){
                            $('.loading-now').remove();
						}
                        $(obj).append('<div class="buy-load"><img class="load-img" src="img/load.png"><span class="load-tips">没有更多了~</span></div>');
                    }
                    
			    }

			    // 倒计时
				function countDownEvent(counmtDomArr) {

			        for(var i=0; i<counmtDomArr.length; i++){

                        $('.' + counmtDomArr[i]).downCount({
//                    date: '3/15/2018 00:00:00',
                            offset: 0,  //+10
                            loadingTiao: true
                        }, function () {
                            // alert('倒计时结束!');
                        });
					}



                }

				//头部导航渲染    全部商品
				getInfo('post',ajaxUrl+'/productsInfo/boon/productType',{},setSpecialHtml);
				function setSpecialHtml(r){
					var html = template('sort-box', r);
					
					$('.sort-box').html(html);

					$(".sort-box ul li").eq(0).addClass('on');
//						
//						//点击不同的导航请求不同的数据
					$(".sort-box ul li").click(function(){
						listLoading = false;
						listLoadingLock = false;   //初始化页面没有被锁定，，可以滚动
						currentpage=0;
						listparamUL.pageNo = currentpage;
						catId=$(this).attr('data-id');
						console.log(catId);
						listparamUL.cat_id=catId;
						
						$(this).addClass('on').siblings().removeClass('on');
						$(this).css('color','#ff5a3a').siblings().css('color','#8a8a8a');
						
						getList('.rec-bro','post',ajaxUrl+'/productsInfo/boon/productlist',listparamUL,getListdata);
						
					});
					
				}
				//筛选
				setclcik();
				function setclcik(){
					
					$('.sort-st').click(function(){
						listLoading = false;
						listLoadingLock = false;
						currentpage=0;
						listparamUL.pageNo = currentpage;
						listparamUL.sort='';
						getList('.rec-bro','post',ajaxUrl+'/productsInfo/boon/productlist',listparamUL,getListdata);
						
					});
					
					$('.sort-cor').unbind('click').click(function(){
						console.log($(this).index())
						listLoading = false;
						listLoadingLock = false;
						currentpage=0;
						listparamUL.pageNo = currentpage;
						if($(this).index()!=4){
							sort=$(this).attr('data-sort');
						}else{
							time++;
							if(time%2==0){
								sort=4;
							}else{
								sort=3;
							}
						}
						listparamUL.sort=sort;
						getList('.rec-bro','post',ajaxUrl+'/productsInfo/boon/productlist',listparamUL,getListdata);

					});
				}
				
				$('.sort-list div').click(function(){
					$(this).css('color','#ff5a3a').siblings().css('color','#9b9b9b');
				});
				
			})
		</script>
	</body>
</html>
