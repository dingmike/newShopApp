<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit">
		<meta content="yes" name="apple-mobile-web-app-capable"/>
		<meta content="black" name="apple-mobile-web-app-status-bar-style" />
		<meta content="telephone=no" name="format-detection"/>
		<meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE,Chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/index.css"/>
		<link rel="stylesheet" type="text/css" href="css/hp.css"/>

		<!--flex 布局-->
		<script src="js/flexible.js" type="text/javascript"></script>
		<script src="js/jquery-1.11.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/default.js"></script>
		<script type="text/javascript" src="js/jquery.downCount.js"></script>
		<script src="js/template.js"></script>
		<script src="js/template-helper.js"></script>

		<title>商品搜索</title>
		<style type="text/css">
			 .rec-bro{padding-bottom: 0;}
			 .buy-load{height: 60px;}

			/* .bro-sto-left {
				 !* display: inline-block; *!
				 height: 7.5rem!important;
			 }
*/
			 .bro-sto-nam {
				 display: block;
				 font-size: 12px;
				 width: 100%;
				 height: 0.5866667rem;
				 line-height: 0.58666667rem;
				 overflow: hidden;
				 text-overflow: ellipsis;
				 white-space: nowrap;
				 /*padding-left: 0.26667rem;*/
				 /* display: -webkit-box; */
				 line-clamp: 2;
				 -webkit-line-clamp: 2;
				 -webkit-box-orient: vertical;
			 }


			 .pt-bottom-box{
				 background: orangered;
				 color: #fff;
				 height: 2.4rem;
			 }
			 .price-bottom-m{
				 display: flex;
				 /* display: -webkit-flex; */
				 /* flex-direction: row; */
				 justify-content: center;
			 }

			 .price-bottom-l {
				 /* padding: 0.05333rem; */
				 /* height: 0.8rem; */
				 /* display: flex; */
				 /* display: -webkit-flex; */
				 /* flex-direction: row; */
				 /* justify-content: center; */
				 padding: 4px 0;
			 }

			 .price-b-l-first {
				 /* float: left; */
				 padding-left: 10px;
				 text-align: left;
				 font-size: 0.6rem;
				 height: 0.8rem;
				 /* line-height: 0.8rem; */
				 /* margin-left: 0.1rem; */
			 }

			 .price-b-l-sencond {
				 float: left;
				 font-size: 0.266667rem;
			 }


			 .price-b-l-sencond .price-logo {
				 background-color: #ffccc6;
				 color: #ff5a3a;
				 width: 0.8rem;
				 height: 0.29333rem;
				 border-radius: 0.10666rem;
				 padding: 0.0266666rem 0.053333rem;
			 }

			 .ju-title{
				 float: left;
				 font-size: 12px;
				 width: 48px;
				 padding-left: 8px;
			 }

			 ul.countdown {
				 /* list-style: none; */
				 /* float: left; */
				 font-size: 0.24rem;
				 /* width: 4.5rem!important; */
				 /* transform: scale(0.8)!important; */
				 display: inline-block;
			 }
			 .price-time {
				 font-size: 0.32rem;
				 /* transform: scale(0.9); */
				 /* height: 0.92rem; */
				 /* line-height: 0.92rem; */
				 margin-left: 0.2rem;
			 }
			 .price-time-loading{
				 margin-top: 0.06rem;
			 }

			 /*loading--start--*/
			 .status-bar[data-v-5d44c782] {
				 position: relative;
				 box-sizing: border-box;
				 width: 2.4rem;
				 height: 0.36rem;
				 /* transform: scale(0.75); */
				 line-height: 0.3733333rem;
				 border-radius: 0.186666667rem;
				 color: #fff;
				 background: url('./img/ad_imgs/beijing.png') repeat-x;
				 background-size: contain;
				 text-align: center;
				 overflow: hidden;
			 }
			 .status-progress[data-v-5d44c782] {
				 border-radius: 0.186666667rem;
				 position: absolute;
				 top: 0;
				 left: 0;
				 height: 100%;
				 min-width: .13rem;
				 /* background: url(/img/ad_imgs/jindu.png) repeat-x; */
				 background-size: contain;
			 }
			 .status-num[data-v-5d44c782] {
				 font-size: 0.32rem;
				 position: absolute;
				 left: 0.8rem;
			 }
			 .status-soldrate[data-v-5d44c782] {
				 font-size: 0.34rem;
				 position: absolute;
				 left: 1.3333rem;
			 }
			 .status-msg-h{
				 position: relative;
				 text-indent: 1.10rem;
				 /*width: 2.32rem;*/
			 }
			 .status-msg-h:before{
				 content: attr(text);
				 line-height: 0.3733333rem;
				 height: 0.333333rem;
				 position: absolute;
				 left: 0;
				 font-size: 0.3rem;
			 }
			 .status-msg-h:after{
				 content: attr(text);
				 position: absolute;
				 left: 0;
				 /* width: 100%; */
				 /* height: 38px; */
				 height: 0.3733333rem;
				 line-height: 0.3733333rem;
				 white-space: nowrap;
				 overflow: hidden;
				 transition: width 1s ease;
				 width: 57%;
				 color: red;
				 font-size: 0.3rem;
				 /* transform: scale(0.75); */
				 /* background: #0BF; */
				 background: url('./img/ad_imgs/jindu.png') repeat-x;
			 }

			 .pin-tuan-h{
				 background-color: #ffffff;
				 width: 1.6rem;
				 height: 0.52rem;
				 line-height: 0.52rem;
				 /* margin-top: 0.37333rem; */
				 border-radius: 4px;
				 margin-left: 0.2666rem;
				 font-size: 0.3733333rem;
				 color: orangered;
				 font-weight: 600;
			 }

			 .bro-zy-num-h {
				 display: block;
				 float: left;
				 color: #a8a8a8;
				 font-size: 0.2433rem;
				 /* border: 1px solid #ff2a00; */
				 /* padding: 0 5px; */
				 /* border-radius: 4px; */
				 overflow: hidden;
				 text-overflow: ellipsis;
				 white-space: nowrap;
				 width: 2.72rem;
			 }
			 .bro-sto-e-h {
				 display: block;
				 float: right;
				 color: #9c9797;
				 font-size: 0.32rem;
				 transform: scale(0.8);
				 /* background-color: #f1f1f1; */
				 border-radius: 2px;
				 text-align: center;
				 /* padding: 1px 4px 1px 4px; */
				 /* width: 61px; */

			 }

		</style>
	</head>
	<body>
		<div class="container">
			
				<header>
				<div class="sto-nav-left">
					<img src="img/fanhui.png"  alt="" onclick="javascript:history.back(-1);"/>
				</div>
				<div class="sto-nav-sear">
					<input type="text" placeholder="" value="" />
					<img src="img/cha.png"/>
				</div>
				<div class="sto-nav-right">
					<img src="img/gouwuche.png"/>
					<div class="nav-car-num"></div>
				</div>
			</header>
			

			<div class="content">
				<div class="sort-list">
					<div class="sort-st">综合排序</div>
					<div class="sort-cor" data-sort='1'>
						销量优先
					</div>
					<div class="sort-cor" data-sort="5">
						拼单优先
					</div>
					<div class="sort-cor" data-sort='2'>
						广告金优先
					</div>
					<div class="sort-cor xdui" data-sort=''>
						价格
						<div class="sanjiao-box">
							<span class="sanjiao-down"></span>
   	 						<span class="sanjiao-up"></span>
						</div>
					</div>
				</div>
				
				<div class="rec-bro top10" style="font-size: 0.32rem;text-align: center;"></div>
				<!--<script type="text/template" id="rec-bro">
					{{each data.data as k i}}
							
							<div class="bro-sto-left">
								<a href="sto-detail.html?id={{k.productId}}">
									<div class="bro-img">
										<img src="{{k.productImg}}">
									</div>
									<span class="bro-sto-nam">{{k.productName}}</span>
									<div class="bro-num-box">
										<span class="bro-sto-num">￥{{k.sellPrice}}</span>
										{{if k.marketPrice!=null}}
										<span class="bro-sto-yj"><s>￥{{k.marketPrice}}</s></span>
										{{/if}}
									</div>
									<div class="bro-zy-box">
										
										<span class="bro-zy-num">自营</span>
								
										{{if k.productExpfee==0}}
											<span class="bro-by-num">包邮</span>
										{{/if}}
										{{if k.productEdian!=0}}
											<span class="bro-sto-e">e点:<span class="e-st">{{k.productEdian}}</span></span>
										{{/if}}
									</div>
								</a>
							</div>
							
					{{/each}}
				</script>-->
				<script type="text/template" id="rec-bro">
					{{each data as k i}}

					<div class="bro-sto-left">
						<a href="{{k.fightAloneTime !==null?'sto-detail-pd.html':'sto-detail.html'}}?id={{k.productId}}">
							<div class="bro-img">
								<img src={{k.productImg}}>
							</div>
							<span class="bro-sto-nam">{{k.productName}}</span>
							<div class="bro-num-box">
								<span class="bro-sto-num">￥{{k.sellPrice}}</span>
								<span class="bro-sto-yj"><s>￥{{k.marketPrice}}</s></span>
								{{if k.productEdian!=0}}
								<span class="bro-sto-e">广告金:<span class="e-st">{{k.productEdian*k.fxparam}}</span></span>
								{{/if}}
							</div>

							{{if k.fightAloneTime !==null}}
							<div class="pt-bottom-box">
								<div class="price-bottom-l">
									<div class="price-b-l-first">￥<span>{{k.collagePrice}}</span></div>
									<div class="price-time"><span class="ju-title">距结束：</span>
										{{if k.fightAloneTime!==null}}
										<ul class="countdown countdown{{k.productId}}"  data-clock="{{k.fightAloneTime}}">
											<li style="">
												<span class="days">00</span>
											</li>
											<li class="seperator" style="">天</li>
											<li><span class="hours">00</span>
											</li>
											<li class="seperator">:</li>
											<li><span class="minutes">00</span>
											</li>
											<li class="seperator">:</li>
											<li><span class="seconds">00</span>
											</li>
										</ul>
										{{/if}}
									</div>
								</div>
								<div class="price-bottom-m">
									<div class="price-time-loading">
										<div data-v-5d44c782="" class="status-bar">
											<div data-v-5d44c782="" class="status-progress"></div>
											<div data-v-5d44c782="" class="status-msg-h"  data-total="{{k.fightAloneNumber}}" data-last="{{k.areadFightAlone}}" id="myStatusLoading{{k.productId}}" text="{{k.areadFightAlone}}/{{k.fightAloneNumber}}">
												<!-- <div data-v-5d44c782="" class="status-num">10</div>
                                                 <span data-v-5d44c782="" class="status-soldrate">200</span>-->
											</div>
										</div>
									</div>
									<button class="pin-tuan-h" data-productId="{{k.productId}}">马上拼</button>
								</div>
							</div>
							{{else}}
							<div class="bro-zy-box">
								{{if k.shopName}}
								<span class="bro-zy-num-h">{{k.shopName}}</span>
								{{/if}}
								<span class="bro-sto-e-h"><span>{{k.productSales}}人付款</span></span>
							</div>
							{{/if}}
						</a>
					</div>
					{{/each}}
				</script>
			</div>
		</div>
		<script type="text/javascript">
			$(function(){

                // 获取分销ID和值
                var fxIdData;
                getFxId(function(res){
                    fxIdData = res;
                });


				var sort='',time=0;//点击次数;
				//分页  初始化
				var arul = location.search;
 				var search =decodeURI(arul.split('=')[2]);  
				var type = GetUrlString('type');
 				var listparamUL={
					search:search,
					sortType:sort,
					type:type,
					pageNo:1,
					pageSize:4
				};
				
				$('.sto-nav-sear').find('input').attr('placeholder',search);
				
				//判断用户登录过没有
				if(!token){
					$('.nav-car-num').css('display','none');
				}else{
						//个人的购物数量		
					getInfo('post', ajaxUrl+'/productsInfo/cartCount?token=' + token, {}, setcartCountHtml);
					function setcartCountHtml(r) {
						$('.nav-car-num').text(r.count);
					}
				}
				
				//  m没有登录请求登录去
				$('.sto-nav-right img').click(function(){
					if(!token){
						location.href='login.html';
					}else{
						location.href='store.html';
					}
				});
				
				
				
				//页面进来的时候初始化数据
				getList('.rec-bro','post',ajaxUrl+'/front/shop/search',listparamUL,getListdata);
				
				$('.content').scroll(function () {
			        totleHeight = parseFloat($('.content').height()) + parseFloat($('.content').scrollTop());
			        if (($(".content")[0].scrollHeight == totleHeight) && !listLoading) {
			            ++currentpage;
			            listparamUL.pageNo=currentpage;
			            setclcik();
			            console.log(currentpage);
			            $('.sort-list div').click(function(){
							$(this).css('color','#ff5a3a').siblings().css('color','#9b9b9b');
						});
			            getList('.rec-bro','post',ajaxUrl+'/front/shop/search',listparamUL,getListdata);

			        }
			    });
			    
			    //页面渲染    
			    function getListdata(obj,r){
			    	var length = r.data.length;
			    	if (length === 0 && currentpage === 1) {
                        $(obj).html('<div class="_nodata">暂无数据</div>');
                    } else if (length !== 0) {

                        // 显示广告金
                        for(var i=0; i<r.data.length; i++){
                            var newObj = JSON.parse(JSON.stringify(r.data[i]));
                            for(var j = 0; j< fxIdData.length; j++){
                                if(newObj.fxparam == fxIdData[j].id){
                                    r.data[i].fxparam =fxIdData[j].mine;
                                }
                            }

                        }

                        var html= template('rec-bro', r);

                        var countDownArr=[];
                        $.each(r.data, function (key, val) {

                            countDownArr.push('countdown' + val.productId);
                        });

                        if (currentpage === 1) {
                            $(obj).html(html);
                            //倒计时
                            countDownEvent(countDownArr);
                        } else {
                            $(obj).append(html);
                            //倒计时
                            countDownEvent(countDownArr);
                        }
                    } else {
                        listLoadingLock = true;
                       // alert(0)
                        $(obj).append('<div class="buy-load"><img class="load-img" src="img/load.png"><span class="load-tips">没有更多了~</span></div>');
                    }
                    
			    }


                // 倒计时
                function countDownEvent(counmtDomArr) {

                    for(var i=0; i<counmtDomArr.length; i++){

                        $('.' + counmtDomArr[i]).downCount({
//                    date: '3/15/2018 00:00:00',
                            offset: +8,  //+10
                            loadingTiao: true
                        }, function () {
                            // alert('倒计时结束!');
                        });
                    }



                }

				//筛选
				setclcik();
				function setclcik(){
					$('.sort-cor').unbind('click').click(function(){
//						console.log($(this).index())
						listLoading = false;
						listLoadingLock = false;
						currentpage=1;
						listparamUL.pageNo = currentpage;
						if($(this).index()!=3){
							sort=$(this).attr('data-sort');
						}else{
							time++;
							if(time%2==0){
								sort=4;
							}else{
								sort=3;
							}
						}
						listparamUL.sortType=sort;
						getList('.rec-bro','post',ajaxUrl+'/front/shop//search',listparamUL,getListdata);
						
					});
				}
				$('.sort-list div').click(function(){
					$(this).css('color','#ff5a3a').siblings().css('color','#9b9b9b');
				});
				
				$('.sto-nav-sear').find('input').click(function(){
					location.href="search.html";
				});
				
			})
		</script>
	</body>
</html>
