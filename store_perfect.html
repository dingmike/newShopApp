<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>商家入驻2</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE,Chrome=1">
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
    <meta content="telephone=no" name="format-detection"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
    <link rel="stylesheet" href="css/merchant_entry.css">
    <link rel="stylesheet" type="text/css" href="css/index.css"/>
    <link rel="stylesheet" href="css/hp.css"/>
    <link rel="stylesheet" href="./lib/layer_mobile/need/layer.css"/>
    <link rel="stylesheet" type="text/css" href="css/mobileSelect.css">

    <!--flex 布局-->
    <script src="js/flexible.js" type="text/javascript"></script>
    <script src="js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="js/default.js"></script>
    <script src="js/template.js"></script>
    <script src="js/template-helper.js"></script>

    <script src="js/mobileSelect.js" type="text/javascript"></script>
    <!--<script src="js/LArea.js"></script>-->
    <script src="js/regionData.js"></script>


    <script type="text/javascript" src="./lib/layer_mobile/layer.js"></script>
    <script src="js/distpicker.data.js"></script>
    <script src="js/distpicker.js"></script>
    <style>

        body {
            overflow-x: hidden
        }
        .demo1{
            width: 13rem;!important;
            margin-left: 1.2rem;float: left; font-size: 12px;
        }
        .content1 {
            -webkit-box-flex: 1;
            overflow: auto;
            overflow-: hidden;
        }

        * {
            -webkit-overflow-scrolling: touch;
        }

        #regAddressId {
            width: 5.04rem;
            /* margin-left: 1.266667rem; */
            height: 29px;
            border-radius: 5px;
            caret-color: red;
            padding-left: 6px;
            position: absolute;
            left: 1.6rem;
            top: 0.2rem;
        }

        .own-cell-select {
            width: 72%;
            padding-left: 0.8rem;
        }

        .wechat-login {
            margin-bottom: 1.17333rem;
        }

        .demo1{
            width: auto;!important;
            margin-left: 10px!important;
            float: left;
        }
    </style>
</head>
<body>

<div class="content1">
    <!--head-->
    <div class="head">
        <img src="img/merchant_entry/arrow.png" onclick="javascript:history.back(-1);">
        商家入驻
    </div>
    <!--picture-->
    <div class="picture">
        <img src="img/merchant_entry/background.png" class="picture_background">
        <img src="img/merchant_entry/stepsbar2.png" class="stepsbar">
    </div>

    <!-- <div class="perfect_input wechat-login">
         <img src="img/wechat.png" class="wechat-img">
         <span class="wechat-span">
                 店铺必须绑定微信
             </span>
     </div>-->

    <div class="perfect_input">
        店铺账号
        <input type="text" class="shopAccount" placeholder="6-12含有字母和数字的账号 "/>
    </div>
    <div class="perfect_input">
        登录密码
        <input type="password" class="shopPassword" placeholder="6-12位密码 "/>
    </div>
    <div class="perfect_input">
        确定密码
        <input type="password" class="shopPassword2" placeholder="确定密码  "/>
    </div>
    <div class="perfect_input">
        店铺名称
        <input type="text" class="shopName" placeholder="店铺名称  "/>
    </div>
    <div class="perfect_input">
        店铺属性
        <select class="own-cell-select attrType">
            <option value="">--请选择--</option>
            <option value="2">企业</option>
            <option value="3">个人</option>
        </select>
    </div>
    <div class="perfect_input">
        店铺类型
        <select class="own-cell-select onlineOrOff">
            <option value="">--请选择--</option>
            <option value="1">线上店铺</option>
            <option value="2">线下店铺</option>
        </select>
    </div>

    <div id="distpicker" class="csBox" style="display: none">

        <div class="perfect_input">
            服务商所在省
            <select class="pickers" id="province3"
                    data-province="&#45;&#45;选择&#45;&#45;"></select>
        </div>
        <div class="perfect_input">
            服务商所在市
            <select class="pickers" id="city3"
                    data-city="&#45;&#45;选择&#45;&#45;"></select>
        </div>
        <div class="perfect_input">
            服务商所在区县
            <select class="pickers" id="district3"
                    data-district="&#45;&#45;选择&#45;&#45;"></select>
        </div>
        <div class="perfect_input">
            城市服务商
            <select class="own-cell-select" style="width: 68%;padding-left: 0.4rem;" id="csAccountId">
                <option value="">--请选择--</option>
                <script type="text/template" id="csAccontOptions">
                    {{each data as option index}}
                    <option value="{{option.account}}">
                        {{if option.proxyServerName==null}}
                        {{option.relName}}
                        {{else}}
                        {{option.proxyServerName}}
                        {{/if}}
                    </option>
                    {{/each}}
                </script>
            </select>
        </div>
    </div>


    <div class="perfect_input">
        推荐人账号
        <input type="text" class="tuiName" style="width: auto" placeholder="推荐人账号 "/>
    </div>


    <div class="perfect_input ">

       <!--&lt;!&ndash; <input id="regAddressId" type="text" class="inp&ndash;&gt;ut_box-input demo" readonly="" placeholder=" 注册地址" value=""/>-->
        <!--<input id="value1" type="hidden" value=""/>-->

        <div style="float: left; width: 65px;">店铺地址</div>
        <div id="trigger3" class="demo1 address" >-请选择-</div>
        <input id="value1" type="hidden" value=""/>
    </div>

    <div class="button button_perfect">
        提 交
    </div>


</div>


</body>
<script>
    $(function () {

        $("#distpicker").distpicker({
            autoSelect: false,
            province: "四川省",
            city: "绵阳市",
            district: "涪城区"
        });

//        var province = $('#province3').find('option:selected').data('code');
//        var city = $('#city3').find('option:selected').data('code');
//        var district = $('#district3').find('option:selected').data('code');


        // 线下店铺 才选择城市服务商
        $('.onlineOrOff').on('change', function () {
            if ($(this).val() == 2) {
                $('.csBox').show().children().show().val('');
            } else {
                $('.csBox').hide().children().hide().val('');
                $('#csAccountId').val('');
            }
        });
        $('.pickers').on('change', function () {
            var code = $(this).find('option:selected').data('code');
            //加载城市服务商
            $.get(ajaxUrl + '/front/shop/proxyServer', {code: code.toString()}, function (res) {
                var proxyHtml = template('csAccontOptions', res);
                $('#csAccountId').empty().append(proxyHtml);
            });
        });

        var regShopAccount = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,12}$/;//6-12位数字加字母组成
        var regPass = /^\d{6,12}$/;//6-12位数字组成
        var token = localStorage.getItem('token');
        console.log(token);



        // 省市区联动
        var mobileSelectCity = new MobileSelect({
            trigger: '#trigger3',
            title: '请选择',
            wheels: [
                {data:LAreaData}
            ],
            transitionEnd:function(indexArr, data){
//                        console.log('定位的地址:' +data);
            },
            callback:function(indexArr, data){
                var addressStr = '';
                var addressCode ='';
                for(var i=0; i<data.length;i++){
                    addressStr = addressStr + data[i].name + ',';
                    addressCode = addressCode + data[i].code+ ',';
                }
                $('#value1').val(addressCode);
            }
        });

        /* var area1 = new LArea();
         area1.init({
         'trigger': '#regAddressId', //触发选择控件的文本框，同时选择完毕后name属性输出到该位置
         'valueTo': '#value1', //选择完毕后id属性输出到该位置
         'keys': {
         code: 'code',
         name: 'name'
         }, //绑定数据源相关字段 id对应valueTo的value属性输出 name对应trigger的value属性输出
         'type': 1, //数据源类型
         'data': LAreaData //数据源
         });*/


//	$.ajax({
//		type:"post",
//		url:"/shop/front/shop/selectCatName",
//		data:{
//			token:token,
//		},
//		async:true,
//		success:function(r){
//			console.log(r)
//		},
//	});
        //$.post('/shop/front/shop/selectCatName',{token:token},function(r){})

        $('.button').click(function () {
            var shopAccount = $('.shopAccount').val();
            var shopPassword = $('.shopPassword').val();
            var shopPassword2 = $('.shopPassword2').val();
            var shopName = $('.shopName').val();
            var tuiName = $('.tuiName').val();
            var shopAddress = $('#value1 ').val().slice(0, $('#value1 ').val().length-1);

            var onlineOrOff = $('.onlineOrOff ').val(); // 店铺类型 1线上，2线下
            var type = $('.attrType ').val(); // 店铺属性 2企业，3个人

            var csAccount = $('#csAccountId').val(); // 城市服务商

            var cat = [];
            $('.pull-down_div select').each(function () {
                if ($(this).val()) {
                    cat.push($(this).val());
                }
            });
            var data = {
                token: token,
                shopAccount: shopAccount,
                shopPassword: shopPassword,
                shopPassword2: shopPassword2,
                shopName: shopName,
                account: tuiName,
                address: shopAddress,
                webType: onlineOrOff,
                csAccountId: csAccount,
                type: type,
                cat: cat
            };
            if (!shopAccount) {
//			tip.flag('店铺账号不能为空','error');
                layer.open({
                    content: '店铺账号不能为空!'
                    , skin: 'msg'
                    , time: 2 //2秒后自动关闭
                });
            } else if (!regShopAccount.test(shopAccount)) {
//			tip.flag('账号为6-12位数字加字母','error');
                layer.open({
                    content: '账号为6-12位数字加字母!'
                    , skin: 'msg'
                    , time: 2 //2秒后自动关闭
                });
            } else if (!shopPassword) {
//			tip.flag('登录密码不能为空','error');
                layer.open({
                    content: '登录密码不能为空!'
                    , skin: 'msg'
                    , time: 2 //2秒后自动关闭
                });
            } else if (!regPass.test(shopPassword)) {
//			tip.flag('密码为6-12位数字','error');
                layer.open({
                    content: '密码为6-12位数字!'
                    , skin: 'msg'
                    , time: 2 //2秒后自动关闭
                });
            } else if (!shopPassword2) {
//			tip.flag('确定密码不能为空','error');
                layer.open({
                    content: '确定密码不能为空!'
                    , skin: 'msg'
                    , time: 2 //2秒后自动关闭
                });
            } else if (shopPassword != shopPassword2) {
//			tip.flag('两次密码不一致','error');
                layer.open({
                    content: '两次密码不一致!'
                    , skin: 'msg'
                    , time: 2 //2秒后自动关闭
                });
            } else if (!shopName) {
//			tip.flag('店铺名称不能为空','error');
                layer.open({
                    content: '店铺名称不能为空!'
                    , skin: 'msg'
                    , time: 2 //2秒后自动关闭
                });
            } else /*if(cat.length<=0){
             tip.flag('经营项目至少一个','error');
             }else if(cat.length>=4){
             tip.flag('经营项目最多三个','error');
             }else*/{
                $.ajax({
                    type: "post",
                    url: ajaxUrl + "/front/shop/applyTwo",
                    data: data,
                    async: true,
                    traditional: true,
                    success: function (r) {
                        if (r.code == 200) {
//                            window.location.href = 'store_submit.html';// 第二步以后全部放在后台填写
                            window.location.href = 'store_over.html?newReg=1';
                        } else {
//						tip.flag(""+r.msg+"", 'error');
                            layer.open({
                                content: r.msg
                                , skin: 'msg'
                                , time: 2 //2秒后自动关闭
                            });
                        }
                    }
                });
            }
        });
    });
</script>
</html>