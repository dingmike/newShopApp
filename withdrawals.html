<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE,Chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
    <link rel="stylesheet" type="text/css" href="css/index.css"/>
    <link rel="stylesheet" type="text/css" href="css/hp.css"/>
    <link rel="stylesheet" href="./lib/layer_mobile/need/layer.css"/>
    <script src="js/jquery-1.11.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/default.js"></script>
    <script src="js/template.js"></script>
    <script src="js/template-helper.js"></script>
    <script type="text/javascript" src="./lib/layer_mobile/layer.js"></script>
    <title>提现</title>
    <style type="text/css">
        .pay_mode {
            height: 350px;
            top: 187px;
            left: 100%;
            width: 85%;
            height: 160px;
            border-radius: 10px;
        }

        .account-box ul li {
            display: none;
        }

        .zhifu-p {
            line-height: 19px;
        }

        .sur-rgt-place {
            height: 18px;
            display: block;
            float: right;
            color: #ff5a3a;
            padding-left: 10px;
            border-left: 1px solid #EBEBEB;
        }
    </style>
    <script type="text/javascript">
        $(document).ready(function () {                        /*判断输入框值*/
            var status = setTimeout('getvalue()', 0);
            /*当输入框大于1的时候*/
        });
        /*提现按钮变色*/
        function getvalue() {
            var value = $('#txje').val();
            status = setTimeout('getvalue()', 0);
            if (value >= 1) {
                $(document).ready(function () {
                    $('.qr-cge').css('background-color', '#ff5a3a');
                });
            } else if (value <= 0) {
                $(document).ready(function () {
                    $('.qr-cge').css('background-color', '#D4D4D4');
                });
            }
        }
    </script>
</head>
<body>
<div class="container">
    <header class="bod-show">
        <img class="nav-left" src="img/fanhui.png" onclick="javascript:history.back(-1)"/>
        提现
    </header>

    <div class="content">
        <div class="account-box">
            <ul>
                <li data-sure="yes" class="zfb">
                    <img class="zhifu-img" src="img/zhifubaozhifu.png"/>
                    <div class="zhifu-cet">
                        <p class="zhifu-p">支付宝收款</p>
                        <p class="zfb_id"></p>
                    </div>
                </li>
                <!--<li class="wx">
                    <img class="zhifu-img" src="img/weixinzhifu.png"/>

                    <div class="zhifu-cet">
                        <p class="zhifu-p">微信收款</p>
                        <p class="wx_id"></p>
                    </div>
                </li>-->
                <li class="yzf">
                    <img class="zhifu-img" src="img/bd-yh.png"/>

                    <div class="zhifu-cet">
                        <p class="zhifu-p">银行卡</p>
                        <p class="yzf_id"></p>
                    </div>
                </li>
                <!--<li class="yzf">
                    <img class="zhifu-img" src="img/yizhifu.png"/>
                    <div class="zhifu-cet">
                        <p class="zhifu-p">翼支付收款</p>
                        &lt;!&ndash;<p class="yzf_id"></p>&ndash;&gt;
                    </div>
                </li>-->
            </ul>
            <div class="sk-rgt">
                更换
                <img class="sk-rtu" src="img/rtu.png"/>
            </div>
        </div>
        <div class="change-mon">
            <div class="sur">
                <span class="sur-left">剩余余额:<strong class="balance_money"></strong>元</span>
                <!--<span class="sur-rgt">全部提现</span>-->
                <span class="sur-rgt-place">请输入10的倍数,最低100可提现</span>
            </div>
            <p class="use-tit">提现总额/元：</p>
            <input type="text" class="e-num ipt checkTen" name="" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" id="txje" placeholder="0.00" value="" />
            <!--<input type="text" class="e-num ipt checkTen" name="" onafterpaste="if (!/^([\d]|[1-9]\d*0)$/g.test(this.value))this.value=''" id="txje" placeholder="0" value=""/>-->
            <div class="bottom"></div>
            <div class="sur">
						<span class="sur-left" >
                            提现金额:&nbsp;&nbsp;<span id="withMoneyId" style="color: #ff8b1a;">0.00</span>
                            &nbsp;&nbsp;消费积分:&nbsp;&nbsp;<span id="sellCoinsId" style="color: #ff8b1a;">0.00</span>
						</span>
            </div>
            <div class="sur">
						<span class="sur-left">
							实得金额:&nbsp;&nbsp;<span class="yel">0.00</span>
							&nbsp税收:&nbsp;&nbsp;<span class="sui">0.00</span><span class="blue">&nbsp;&nbsp;(个人, 增值, 附加税)</span>
						</span>
            </div>
        </div>
        <div class="qr-btn ma-top">
        <button class="qr-cge">确认提现</button>
        </div>
    </div>
</div>

<div class="pay_mode_bg">

</div>
<div class="pay_mode">
    <div class="pay_mode_tit">
        选择支付方式<img src="img/guanbi.png" alt=""/>
    </div>
    <div class="pay_ways">

        <div class="order_line margin10 pitchon">
            <img src="img/zhifubaozhifu.png" alt=""/>支付宝支付
        </div>

        <!--<div class="order_line">
            <img src="img/weixinzhifu.png" alt="" />微信支付
        </div>-->
        <div class="order_line">
            <img src="img/bd-yh.png" alt=""/>银行卡
        </div>
        <!--<div class="order_line">
            <img src="img/yizhifu.png" alt="" />翼支付
        </div>-->
    </div>

    <!--<button class="pay_yes" id="J_OpenKeyBoard">确定支付</button>-->
</div>
<script>
    $(function () {
//				监听输入框变化
        $('#txje').bind('input propertychange', function () {
            var price = $("#txje").val();

            $('#withMoneyId').text(parseInt(price/2));
            $('#sellCoinsId').text(parseInt(price/2));


            if (price.length != 0) {
                $.post(ajaxUrl + '/front/XtWithdrawControllerFront/revenue', {
                    token: token,
                    amount: parseInt(price/2)
                }, function (r) {
                    console.log(r);
                    $('.yel').text(r.actualAmount);
                    $('.sui').text(r.tax);
                });
            } else {
                $('.yel').text(0.00);
                $('.sui').text(0.00);
            }
        });

        $('.sk-rgt').click(function () {
            $(".pay_mode_bg").attr("style", "display:block");
            $(".pay_mode").css({
                'left': '7%',
                'transition': 'left 0.5s'
            });
        });


        $(".pay_mode_bg,.pay_mode_tit img").click(function () {
            $(".pay_mode_bg").attr("style", "display:none");
            $(".pay_mode").css({
                'left': '100%',
                'transition': 'left 0.5s'
            });
        });

        //支付方式选择
        $('.account-box ul li').eq(0).css('display', 'block');
        $(".pay_ways .order_line").click(function () {
            var index = $(this).index();
            console.log(index);
            $(this).addClass("pitchon").siblings().removeClass("pitchon");
            $('.account-box ul li').eq(index).attr('data-sure', 'yes').css('display', 'block').siblings().attr('data-sure', 'no').css('display', 'none');

        });
        // 初始化个人账户和余额
        $.post(ajaxUrl + '/front/XtWithdrawControllerFront/withdraw', {token: token}, function (r) {
            $('.zfb_id').text(r.zfb);
            $('.wx_id').text(r.wx);
            $('.yzf_id').text(r.bank);
            $('.balance_money').text(r.balance)
        }, 'json');
        // 全部提现按钮
        $('.sur-rgt').click(function () {
            $('.e-num').val($.trim($('.balance_money').text()));
        });
        // 提现接口
        function comeMoney(amount, account, accountType) {
            $.post(ajaxUrl + '/front/XtWithdrawControllerFront/confirmWithdraw', {
                token: token,
                amount: amount,
                account: account,
                accountType: accountType

            }, function (r) {
                if (r.code == 300) {
                    tip.flag(r.msg, 'error');
                    setTimeout(function () {
                        window.location.href = 'personal-data.html';
                    }, 1500);
                } else {
                    tip.flag(r.msg, 'success');
                    setTimeout(function () {
                        window.location.href = 'detail-all.html?type=0';
                    }, 2000);
                }
            })
        }

        // 只能输入10的倍数
        $('.checkTen').blur(function () {
            var price = $(this).val();
            if (!/^([\d]|[1-9]\d*0)$/g.test(price)){
                $('.qr-cge').css('background-color', '#ccc').attr('disabled','disabled');
                layer.open({
                    content: '请输入10的倍数！'
                    ,skin: 'msg'
                    ,time: 2 //2秒后自动关闭
                });
debugger
                if(price<100){
                    layer.open({
                        content: '输入金额必须大于100！'
                        ,skin: 'msg'
                        ,time: 2 //2秒后自动关闭
                    });
                    return
                }
            }else{
                $('.qr-cge').css('background-color', '#ff5a3a').attr('disabled',false);
            }
            if (parseInt(price)!= 0) {
                $.post(ajaxUrl + '/front/XtWithdrawControllerFront/revenue', {
                    token: token,
                    amount: parseInt(price/2)
                }, function (r) {
                    console.log(r);
                    $('.yel').text(r.actualAmount);
                    $('.sui').text(r.tax);
                });

            } else {
                $('.yel').text(0.00);
                $('.sui').text(0.00);
            }
    });

    $('.qr-cge').click(function () {
        var payMoney = parseFloat($('.e-num').val());
        if (!payMoney) {
            tip.flag('请输入充值金额', 'error');
        } else if (payMoney > parseFloat($.trim($('.balance_money').text()))) {
            tip.flag('余额不足', 'error');
        } else {
            $('.account-box ul li').each(function () {
                if ($(this).attr('data-sure') == 'yes') {
                    var way = $(this).attr('class');
                    var amount = payMoney/2;//申请提现金额
                    var account = $.trim($(this).find('p').eq(1).text());
                    console.log(account);
                    switch (way) {
                        case 'zfb':
                            comeMoney(amount, account, 0);
                            break;
                        case 'wx':
                            comeMoney(amount, account, 1);
                            break;
                        case 'yzf':
                            comeMoney(amount, account, 2);
                            break;
                        default:
                            break;
                    }

                }
            });
        }

    });

    })
</script>
</body>
</html>
